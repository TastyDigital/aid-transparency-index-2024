"use strict";(function(a){"use strict";a(document).ready(()=>{if(a("#nav-tab").length&&a("#deep-dive").length){let b=location.href.replace(/\/$/,"");const c=()=>{a("html, body").animate({scrollTop:a("#deep-dive").offset().top},1e3)};if(location.hash){const d=b.split("#");a("#nav-tab a[href=\"#"+d[1]+"\"]").tab("show"),b=location.href.replace(/\/#/,"#"),history.replaceState(null,null,b),c()}a("a[data-toggle=\"tab\"]").on("click",function(){let d;const e=a(this).attr("href");d="#organisational-planning-and-commitments"===e?b.split("#")[0]:b.split("#")[0]+e,d+="/",history.replaceState(null,null,d),a(this).hasClass("tab-toggler")&&(a("#nav-tab a[href=\""+e+"\"]").tab("show"),c())})}const b=a("#donor-graphic");if(0<b.length){const c=b[0].getContext("2d",{alpha:!1}),d=b.data("code"),e=b.data("colours").split(","),f=b.data("path"),g=["Very good","Good","Fair","Poor","Very poor"],h=3,i=[],j=24,k=10,l=b.attr("width"),m=b.attr("height"),n=m-2*k;a.getJSON(f,function(a){var b=Math.PI;let f=g.length,o=!1,p=[];Object.keys(a).map((b,c)=>(a[b].label=a[b].name+" ("+a[b].score.toFixed(1)+")",a[b].id=c,a[b].code=b,p.push(a[b])));let q=p.length;g.map((a,b)=>{let c=p.filter(b=>b.performance_group===a),g=[];return g.label=a,g.color=e[0],g.donors=[],c.map(a=>(a.code===d&&(o={cat:b,donor:a.id,label:a.label}),g.donors.push({id:a.id,score:(a.score*(n/100)).toFixed(2)}))),g.donors.length<h?(f+=1,q-=g.donors.length):q-=1,i.push(g)});const r=((l-(f-1)*j-2*k)/q).toFixed(2);c.beginPath(),c.moveTo(0,0),c.lineTo(l,0),c.lineTo(l,m),c.lineTo(0,m),c.fillStyle="#FFFFFF",c.fill();let s=0,t=k;if(i.forEach((a,b)=>{o&&o.cat!==b&&(a.color="#ececec"),c.beginPath(),c.moveTo(s*r+t,n+k),a.donors.length<h?(c.lineTo(s*r+t,(n+k-a.donors[0].score).toFixed(1)),c.lineTo(s*r+t+j,(n+k-a.donors[a.donors.length-1].score).toFixed(1)),c.lineTo(s*r+t+j,n+k),c.moveTo(s*r+t,n+k),o&&o.cat===b&&a.donors.forEach(a=>{o.donor===a.id&&(o.x=s*r+t,o.y=(n+k-a.score).toFixed(1))}),t+=j):(a.donors.forEach((d,e)=>{c.lineTo(s*r+t,(n+k-d.score).toFixed(1)),o&&o.donor===d.id&&o.cat===b&&(o.x=s*r+t,o.y=(n+k-d.score).toFixed(1)),e<a.donors.length-1&&(s+=1)}),c.lineTo(s*r+t,n+k)),c.fillStyle=a.color,c.fill(),t=s*r+t+j,s=0}),o){let a=e[1];c.beginPath(),c.setLineDash([10,5]),c.moveTo(0,o.y),c.lineTo(o.x,o.y),c.strokeStyle=a,c.stroke(),c.beginPath(),c.arc(o.x,o.y,4,0,2*b),c.setLineDash([]),c.strokeStyle=a,c.fillStyle=a,c.stroke(),c.fill(),c.beginPath(),c.moveTo(o.x,n+k),c.arc(o.x,n+k,4,0,2*b),c.stroke(),c.fill(),c.beginPath(),c.font="12px sans-serif",c.fillStyle=a;let d=c.measureText(o.label),f=o.x+d.width+k>l?l-d.width-k:o.x+6;c.textBaseline="bottom",c.fillText(o.label,f,o.y-6)}})}})})(jQuery);