"use strict";(function(a){"use strict";a(document).ready(function(){if(a("#nav-tab").length&&a("#deep-dive").length){var b=location.href.replace(/\/$/,""),c=function(){a("html, body").animate({scrollTop:a("#deep-dive").offset().top},1e3)};if(location.hash){var d=b.split("#");a("#nav-tab a[href=\"#"+d[1]+"\"]").tab("show"),b=location.href.replace(/\/#/,"#"),history.replaceState(null,null,b),c()}a("a[data-toggle=\"tab\"]").on("click",function(){var d,e=a(this).attr("href");d="#organisational-planning-and-commitments"===e?b.split("#")[0]:b.split("#")[0]+e,d+="/",history.replaceState(null,null,d),a(this).hasClass("tab-toggler")&&(a("#nav-tab a[href=\""+e+"\"]").tab("show"),c())})}var e=a("#donor-graphic");if(0<e.length){var f=e[0].getContext("2d",{alpha:!1}),g=e.data("code"),h=e.data("colours").split(","),i=e.data("path"),j=["Very good","Good","Fair","Poor","Very poor"],k=3,l=[],m=24,n=10,o=e.attr("width"),p=e.attr("height"),q=p-2*n;a.getJSON(i,function(a){var b=Math.PI,c=j.length,d=!1,e=[];Object.keys(a).map(function(b,c){return a[b].label=a[b].name+" ("+a[b].score.toFixed(1)+")",a[b].id=c,a[b].code=b,e.push(a[b])});var i=e.length;j.map(function(a,b){var f=e.filter(function(b){return b.performance_group===a}),j=[];return j.label=a,j.color=h[0],j.donors=[],f.map(function(a){return a.code===g&&(d={cat:b,donor:a.id,label:a.label}),j.donors.push({id:a.id,score:(a.score*(q/100)).toFixed(2)})}),j.donors.length<k?(c+=1,i-=j.donors.length):i-=1,l.push(j)});var r=((o-(c-1)*m-2*n)/i).toFixed(2);f.beginPath(),f.moveTo(0,0),f.lineTo(o,0),f.lineTo(o,p),f.lineTo(0,p),f.fillStyle="#FFFFFF",f.fill();var s=0,t=n;if(l.forEach(function(a,b){d&&d.cat!==b&&(a.color="#ececec"),f.beginPath(),f.moveTo(s*r+t,q+n),a.donors.length<k?(f.lineTo(s*r+t,(q+n-a.donors[0].score).toFixed(1)),f.lineTo(s*r+t+m,(q+n-a.donors[a.donors.length-1].score).toFixed(1)),f.lineTo(s*r+t+m,q+n),f.moveTo(s*r+t,q+n),d&&d.cat===b&&a.donors.forEach(function(a){d.donor===a.id&&(d.x=s*r+t,d.y=(q+n-a.score).toFixed(1))}),t+=m):(a.donors.forEach(function(c,e){f.lineTo(s*r+t,(q+n-c.score).toFixed(1)),d&&d.donor===c.id&&d.cat===b&&(d.x=s*r+t,d.y=(q+n-c.score).toFixed(1)),e<a.donors.length-1&&(s+=1)}),f.lineTo(s*r+t,q+n)),f.fillStyle=a.color,f.fill(),t=s*r+t+m,s=0}),d){var u=h[1];f.beginPath(),f.setLineDash([10,5]),f.moveTo(0,d.y),f.lineTo(d.x,d.y),f.strokeStyle=u,f.stroke(),f.beginPath(),f.arc(d.x,d.y,4,0,2*b),f.setLineDash([]),f.strokeStyle=u,f.fillStyle=u,f.stroke(),f.fill(),f.beginPath(),f.moveTo(d.x,q+n),f.arc(d.x,q+n,4,0,2*b),f.stroke(),f.fill(),f.beginPath(),f.font="12px sans-serif",f.fillStyle=u;var v=f.measureText(d.label),w=d.x+v.width+n>o?o-v.width-n:d.x+6;f.textBaseline="bottom",f.fillText(d.label,w,d.y-6)}})}})})(jQuery);